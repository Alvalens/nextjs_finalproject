name: Upgrade Compability Check
on: push

jobs:
  upgrade-matrix:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node: [18, 20]
        next: [canary, latest]

    name: Upgrade to NODE ${{matrix.node}} NEXT ${{matrix.next}}

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node ${{matrix.node}}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node }}

      - name: Install dependencies on NODE ${{matrix.node}} in NEXT ${{matrix.next}}
        run: npm install --frozen-lockfile

      - name: Upgrade to CANARY version
        if: ${{matrix.next}} == 'canary'
        run: npm install --no-save next@canary

      - name: Upgrade to LATEST version
        if: ${{matrix.next}} == 'latest'
        run: npm install --no-save next@latest react@latest react-dom@latest eslint-config-next@latest

      - name: Run tests on NODE ${{matrix.node}} in NEXT ${{matrix.next}}
        run: npm test

      - name: Run build on NODE ${{matrix.node}} in NEXT ${{matrix.next}}
        run: npm run build
